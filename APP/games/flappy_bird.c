/*
 * flappy_bird.c
 *
 *  Created on: 2025年11月10日
 *      Author: WangQingChuan
 */
#include <stdio.h>
#include <stdlib.h>

#include "flappy_bird.h"
#include "key.h"
#include "oled.h"

unsigned char cover[] =
{
    0x0, 0x0, 0xc, 0x0, 0x0, 0x0, 0x0, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x0, 0x80, 0x80, 0x80, 0x88, 0x80, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0xc, 0x4, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x10, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x0, 0x0, 0x0, 0x0, 0x4, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x10, 0x18, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x80, 0x80, 0x84, 0x84, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0xfe, 0xff, 0xff, 0xff, 0xff, 0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 0xe7, 0x0, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0, 0x0, 0x80, 0xc0, 0xe0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0x0, 0xe0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xe0, 0xc0, 0xc0, 0x80, 0x80, 0x0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xc0, 0xc0, 0xc0, 0x80, 0x0, 0x0, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0x0, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0x0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc7, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x0, 0x0, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0x0, 0x80, 0x80, 0xc0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0x0, 0x80, 0xc0, 0xe0, 0xe0, 0xe0, 0xe0, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0xff, 0xff, 0xff, 0xff, 0xff, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x0, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0, 0x0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc1, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc1, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xdf, 0xc1, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0, 0x0, 0x3f, 0x7f, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xcf, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0, 0x0, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0x0, 0x0, 0xff, 0xff, 0xff, 0xff, 0xff, 0x3, 0x3, 0x1, 0x1, 0x1, 0x1, 0x0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc3, 0xc3, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x3, 0x3, 0x3, 0x3, 0x3, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x3, 0x3, 0x3, 0x3, 0x3, 0x0, 0x0, 0x0, 0x1, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x7, 0x7, 0x0, 0x7f, 0x7f, 0x7f, 0x7f,
    0x7f, 0x7f, 0x7, 0x7, 0x7, 0x7, 0x1, 0x0, 0x0, 0x0, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7, 0x7, 0x7, 0x3, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x7c, 0x7c, 0x7f, 0x7f, 0x7f, 0x3f, 0x3f, 0x1f, 0x0, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x3, 0x1, 0x0, 0x0, 0x0, 0x7, 0x7, 0x7, 0x7, 0x7, 0x0, 0x1, 0x7, 0x7, 0x7, 0x7, 0x7, 0x0, 0x0, 0x0, 0x80, 0xc0, 0x80, 0x0, 0x0, 0x1, 0x3, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x2, 0x2, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1, 0x3, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x20, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0x0, 0x0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf3, 0xf3, 0xcf, 0xcf, 0x3f, 0x3f, 0x3f, 0xff, 0xff, 0xc0, 0xc0, 0x3f, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc3, 0xc3, 0xfc, 0xfc, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x3, 0x3, 0x3, 0xf, 0xf, 0xcf, 0xcf, 0xcf, 0xcf, 0xf3, 0xf3, 0xfc, 0xfc, 0xfc, 0xff, 0xff, 0xcf, 0xcf, 0x33, 0x33, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xc, 0xc, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x40, 0xc0, 0xc0, 0xc0, 0x40, 0x0, 0xc0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xc0, 0xc0, 0x0, 0x0, 0xc0, 0xc0, 0x0, 0x0, 0x0, 0x80, 0x40, 0x40, 0xc0, 0x0, 0xc0, 0x0, 0x0, 0x0, 0xc0, 0xc0, 0x0, 0x0, 0x0,
    0xc, 0x38, 0x60, 0x80, 0x60, 0x38, 0xc, 0x0, 0xfc, 0x0, 0x80, 0x0, 0xfc, 0x84, 0x84, 0xfc, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xc, 0x18, 0x1f, 0xf, 0x0, 0x0, 0xf, 0x8, 0x8, 0x8, 0x0, 0x0, 0x0, 0x0, 0x0, 0xe, 0x7, 0x3, 0xe, 0xe, 0x3, 0x7, 0xc, 0x0, 0xf, 0x8, 0x8, 0x8, 0x0, 0x0, 0xf, 0x8, 0x8, 0xc, 0x7, 0x1, 0x0, 0x0, 0x0,
};

unsigned char game_over[] =
{
    0xe0, 0x18, 0x1c, 0xc6, 0x62, 0x32, 0x1a, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xf2, 0x2, 0xfe, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xe0, 0x20, 0x10, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x10, 0x30, 0x20, 0xc0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xe0, 0x18, 0xc, 0xc6, 0x22, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x22, 0x66, 0xc4, 0x18, 0xf0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0x20, 0x30, 0x18, 0x98, 0x98, 0x98, 0x98, 0x98, 0x98, 0x18, 0x18, 0x20, 0xe0, 0xc0, 0x0, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    0xff, 0x0, 0x0, 0xff, 0x0, 0x0, 0x0, 0xff, 0x1, 0xf1, 0x11, 0x11, 0x11, 0x11, 0xf1, 0x0, 0xc1, 0x30, 0xc, 0x4, 0x4, 0x84, 0x84, 0x84, 0x4, 0x4, 0x4, 0xfc, 0x0, 0xfc, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x18, 0x60, 0xc1, 0x1, 0x1, 0xf8, 0x7, 0x1, 0x0, 0xe0, 0x10, 0x10, 0xe0, 0x0, 0xf, 0x8, 0xf8, 0x1, 0xfe, 0xfc, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xff, 0x0, 0x0, 0xff, 0x0, 0x0, 0x0, 0xff, 0x1, 0xfe, 0x0, 0x0, 0x0, 0x0, 0xff, 0x0, 0xfc, 0x4, 0x4, 0x4, 0xfc, 0x0, 0x0, 0xfc, 0x4, 0x4, 0x4, 0xfc, 0x0, 0xf8, 0xc, 0xf, 0x0, 0x0, 0xc0, 0x20, 0xc0, 0x0, 0x1, 0xf, 0xf8, 0x1, 0x1, 0xe1, 0x38, 0xc, 0x6, 0x82, 0x82, 0x82, 0x82, 0x82, 0xfe, 0x0, 0x0, 0xff,
    0xff, 0x0, 0x0, 0xff, 0x0, 0x0, 0x0, 0xff, 0x80, 0xff, 0x0, 0x0, 0x0, 0x0, 0xff, 0x0, 0xff, 0x0, 0x0, 0x0, 0x7f, 0x40, 0x40, 0x7f, 0x0, 0x0, 0x0, 0xff, 0x0, 0xff, 0x0, 0x0, 0x0, 0xff, 0x1, 0x1, 0xff, 0x0, 0x0, 0x0, 0x0, 0xff, 0x1, 0x1, 0xff, 0x0, 0x0, 0x0, 0xff, 0x0, 0x0, 0xff, 0x0, 0x0, 0x0, 0x3, 0x84, 0x46, 0x43, 0x40, 0x40, 0x40, 0x7f, 0x0, 0xff, 0xff, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xff, 0x0, 0x0, 0xff, 0x0, 0x0, 0x0, 0x7f, 0x40, 0x7f, 0x0, 0x0, 0x0, 0x0, 0xff, 0x0, 0xff, 0x0, 0x0, 0x0, 0x7f, 0x40, 0x40, 0x7f, 0x0, 0x80, 0xc0, 0x7f, 0x0, 0xff, 0x0, 0x0, 0x0, 0x0, 0x7, 0xc4, 0x27, 0x20, 0x20, 0x20, 0x3f, 0x0, 0x0, 0xff, 0x0, 0x0, 0x0, 0xff, 0x0, 0xf8, 0xfc, 0xc, 0xc, 0xc, 0xc, 0xf,
    0xf, 0x18, 0x30, 0x63, 0x44, 0x48, 0x50, 0x50, 0x50, 0x50, 0x50, 0x50, 0x50, 0x58, 0x4f, 0x40, 0x71, 0x63, 0x46, 0x5c, 0x58, 0x50, 0x50, 0x50, 0x50, 0x50, 0x50, 0x5f, 0x40, 0x5f, 0x50, 0x50, 0x50, 0x5f, 0x40,
    0x40, 0x5f, 0x58, 0x50, 0x50, 0x50, 0x5f, 0x40, 0x40, 0x5f, 0x58, 0x50, 0x50, 0x5f, 0x40, 0x60, 0x73, 0x46, 0x58, 0x50, 0x50, 0x5f, 0x40, 0x40, 0x7f, 0x3, 0x3, 0x3, 0x3, 0x3, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xf, 0x18, 0x30, 0x63, 0x46, 0x4c, 0x50, 0x50, 0x50, 0x50, 0x50, 0x50, 0x4c, 0x62, 0x61, 0x40, 0x4f, 0x50, 0x50, 0x50, 0x50, 0x50, 0x4c, 0x46, 0x63, 0x30, 0x18, 0xc, 0x18, 0x20, 0x43, 0x46, 0x4c, 0x48, 0x48,
    0x4f, 0x40, 0x7e, 0x3, 0x3, 0x3f, 0x40, 0x40, 0x5f, 0x50, 0x50, 0x50, 0x5f, 0x40, 0x7f, 0x7f, 0x0, 0x0, 0x0, 0x0, 0x0,
};

unsigned char image[] =
{
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xe0, 0xe0, 0xf8, 0x1c, 0x18, 0x1c, 0x1c, 0x1c, 0x7, 0x7, 0x7, 0x7, 0x7, 0xe7, 0xe7, 0xe7, 0x1f, 0x1f, 0x17, 0x7, 0x7, 0x7, 0x7, 0x7, 0x18, 0x18, 0xe0, 0xe0, 0xe0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0xfc, 0xfc, 0xff, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x18, 0x18, 0x18, 0xe0, 0xe0, 0x0, 0x0, 0x0, 0x1f, 0x1f, 0x1f, 0xe0, 0xe0, 0xc0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1f, 0x1f, 0x0, 0x0, 0x0, 0xff, 0xff, 0xff, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x7, 0x7, 0x1f, 0x38, 0x38, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0x38, 0x18, 0x18, 0x7, 0x7, 0x0, 0x0, 0x0, 0xe0, 0xe0, 0xe0, 0x38, 0x38, 0xff, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7,
    0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xff, 0x38, 0x38,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x7, 0x7, 0x7, 0x38, 0x38, 0x38, 0x38, 0x18, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe7, 0xe7, 0xff, 0x38, 0x38, 0x38, 0x38, 0x38, 0x38, 0x38, 0x38, 0x38, 0x38, 0x38, 0x38, 0x1c, 0x7, 0x7, 0x3, 0x0, 0x0,
};

unsigned char bird[] =
{
    0x18, 0x64, 0xa6, 0x99, 0x81, 0xa7, 0x71, 0x55, 0x56, 0x7c, 0x10,
};

const Image game_over_Img = {128, 32, game_over};

const Image bird_Img = {8, 8, bird};

const Image image_Img = {45, 32, image};

int global_x1;     // 管道1横坐标（上口宽管道）
int global_y1;     // 管道1纵坐标（下口宽管道）
int global_x2;     // 管道2横坐标（上口宽管道）
int global_y2;     // 管道2纵坐标（下口宽管道）
int global_bird_jump;     // 小鸟跳跃高度
int global_bird_y; // 小鸟纵坐标
int flappy_bird_score; // 得分

int get_button_status()
{
    if (KEY_Confirm == GPIO_PIN_RESET)
    {
        return 1;
    }
    return 0;
}

void draw()
{
    char tmp[15] = {0};

    OLED_NewFrame();

    sprintf(tmp, "%d", flappy_bird_score);
    OLED_PrintASCIIString(80, 0, tmp, &afont8x6, OLED_COLOR_NORMAL); // 显示得分

    OLED_DrawRectangle(global_x1, 0, 10, global_y1, OLED_COLOR_NORMAL);         // 绘制管道1
    OLED_DrawRectangle(global_x1 - 2, global_y1 - 6, 14, 6, OLED_COLOR_NORMAL); // 绘制管道1的缝隙

    OLED_DrawRectangle(global_x1, global_y1 + 30, 10, 64 - global_y1, OLED_COLOR_NORMAL); // 绘制管道1的下管道
    OLED_DrawRectangle(global_x1 - 2, global_y1 + 30, 14, 6, OLED_COLOR_NORMAL);   // 绘制管道1的下管道的缝隙

    OLED_DrawRectangle(global_x2, 0, 10, global_y2, OLED_COLOR_NORMAL);         // 绘制管道2
    OLED_DrawRectangle(global_x2 - 2, global_y2 - 6, 14, 6, OLED_COLOR_NORMAL); // 绘制管道2的缝隙

    OLED_DrawRectangle(global_x2, global_y2 + 30, 10, 64 - global_y2, OLED_COLOR_NORMAL); // 绘制管道2的下管道
    OLED_DrawRectangle(global_x2 - 2, global_y2 + 30, 14, 6, OLED_COLOR_NORMAL);   // 绘制管道2的下管道的缝隙

    OLED_DrawImage(20, global_bird_y, &bird_Img, OLED_COLOR_NORMAL);

    OLED_ShowFrame();
}

void flappy_bird_play()
{
    char tmp[15] = {0};
    unsigned char is_fail = 0;
    global_x1 = 128;
    global_x2 = 192;
    global_y1 = rand() % 42 + 1;
    global_y2 = rand() % 42 + 1;

    global_bird_jump = 32;
    global_bird_y = 10;
    flappy_bird_score = 0;

    while (1)
    {
        if (KEY_Back == GPIO_PIN_RESET)
        {
            return;
        }

        if (is_fail == 0)
        {
            if (get_button_status() == 1)
            {
                global_bird_jump = 16;
            }

            global_x1 = global_x1 - 2;               // 管道1横坐标向左移动
            global_x2 = global_x2 - 2;               // 管道2横坐标向左移动
            global_bird_jump = global_bird_jump - 5;               // 小鸟跳跃高度减少
            global_bird_y = global_bird_y - global_bird_jump / 10; // 小鸟纵坐标减少

            if (global_x1 - 2 < 0) // 管道1最边缘横坐标移动到屏幕外
            {
                global_x1 = 128;
                global_y1 = rand() % 42 + 1;
                if(global_y1 < 6)
                {
                    global_y1 = 6;
                }
            }
            if (global_x2 - 2 < 0) // 管道2最边缘横坐标移动到屏幕外
            {
                global_x2 = 128;
                global_y2 = rand() % 42 + 1;
                if(global_y2 < 6)
                {
                    global_y2 = 6;
                }
            }

            draw();

            if (global_bird_y < 0) // 小鸟纵坐标不能小于0
            {
                global_bird_y = 0;
            }
            if (global_bird_y > 64) // 小鸟纵坐标不能大于64
            {
                is_fail = 1;
            }

            if (global_x1 >= 20 && global_x1 <= 20 + 11) // 小鸟与管道1碰撞，小鸟位置在横坐标20位置上
            {
                if (global_bird_y < global_y1 || global_bird_y + 8 > global_y1 + 30) // 小鸟与管道1碰撞
                {
                    is_fail = 1;
                }
            }
            if (global_x2 >= 20 && global_x2 <= 20 + 11) // 小鸟与管道2碰撞
            {
                if (global_bird_y < global_y2 || global_bird_y + 8 > global_y2 + 30) // 小鸟与管道2碰撞
                {
                    is_fail = 1;
                }
            }

            if (global_x1 == 16 || global_x2 == 16) // 小鸟通过管道
            {
                flappy_bird_score++;
            }

            HAL_Delay(30);
        }

        if (is_fail == 1)
        {
            OLED_NewFrame();
            OLED_DrawImage(0, 0, &game_over_Img, OLED_COLOR_NORMAL);
            OLED_DrawImage(8, 32, &image_Img, OLED_COLOR_NORMAL);
            OLED_PrintString(72, 32, "flappy_bird_score", &font12x12, OLED_COLOR_NORMAL);
            sprintf(tmp, "%d", flappy_bird_score);
            OLED_PrintASCIIString(72, 48, tmp, &afont8x6, OLED_COLOR_NORMAL);

            OLED_ShowFrame();
            if (get_button_status() == 1)
            {
                is_fail = 0;

                global_x1 = 128;
                global_x2 = 192;

                global_y1 = rand() % 42 + 1;
                if(global_y1 < 6)
                {
                    global_y1 = 6;
                }
                global_y2 = rand() % 42 + 1;
                if(global_y2 < 6)
                {
                    global_y2 = 6;
                }

                global_bird_jump = 32;
                global_bird_y = 50;
                flappy_bird_score = 0;
            }

            if (KEY_Back == GPIO_PIN_RESET)
            {
                return;
            }
        }
    }
    return;
}

